# ============================================================================
# TMUX CONFIGURATION - Catppuccin Mocha "VS Code Style" (Fixed Edition)
# ============================================================================

# ── 1. SEPARATOR LIBRARY ──
# Swap these characters to change your theme instantly!
# Rounded:    | Angled:   | Slanted:   | Flame:   | Pixel:  
left_sep=""
right_sep=""
# ── 2. GENERAL SETTINGS ──
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g status-interval 1  # Refresh every second for instant icon swaps
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -sg escape-time 0

# ── 3. KEY BINDINGS ──
bind r source-file ~/.tmux.conf \; display "󰑓 Config reloaded!"
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# ── 4. CATPPUCCIN MOCHA COLORS ──
thm_bg="#1e1e2e"
thm_fg="#cdd6f4"
thm_cyan="#89dceb"
thm_gray="#313244"
thm_magenta="#cba6f7"
thm_pink="#f5c2e7"
thm_orange="#fab387"
thm_blue="#89b4fa"

# ── 5. DYNAMIC COMPONENT SCRIPTS ──
os_icon="#( \
if grep -q 'microsoft' /proc/version 2>/dev/null; then echo '󰍲'; \
elif grep -q 'ubuntu' /etc/os-release 2>/dev/null; then echo '󰕈'; \
elif grep -q 'arch' /etc/os-release 2>/dev/null; then echo '󰣇'; \
else echo '󰌽'; fi)"

# Logic: Pass current command and full directory path to the helper script
window_icon="#(~/.config/tmux/scripts/icon_daemon.sh '#{pane_current_command}' '#{pane_current_path}')"

# ── 6. STATUS BAR DESIGN ──
set-option -g status-position bottom
set-option -g status-style "bg=${thm_bg},fg=${thm_fg}"

set-option -g status-left-length 100
set-option -g status-left "#[fg=${thm_bg},bg=${thm_blue},bold] ${os_icon} #S #[fg=${thm_blue},bg=${thm_bg}]${right_sep}"

set-option -g status-right-length 150
set-option -g status-right "#[fg=${thm_magenta},bg=${thm_bg}]${left_sep}#[fg=${thm_bg},bg=${thm_magenta}] 󰉋 #{b:pane_current_path} #[fg=${thm_gray},bg=${thm_magenta}]${left_sep}#[fg=${thm_fg},bg=${thm_gray}]  #(whoami) #[fg=${thm_pink},bg=${thm_gray}]${left_sep}#[fg=${thm_bg},bg=${thm_pink}] 󰃭 %b %d #[fg=${thm_cyan},bg=${thm_pink}]${left_sep}#[fg=${thm_bg},bg=${thm_cyan},bold] 󱑒 %H:%M "

# ── 7. WINDOW STATUS (The VS Code Style logic) ──
set-option -g window-status-separator " "

# Inactive Window: Icon + Basename of Path
set-option -g window-status-format "#[fg=${thm_gray},bg=${thm_bg}]${left_sep}#[fg=${thm_fg},bg=${thm_gray}]#I #[fg=${thm_fg},bg=${thm_gray}]${window_icon} #{b:pane_current_path}#[fg=${thm_gray},bg=${thm_bg}]${right_sep}"

# Active Window: Icon + Basename of Path (Highlighted Orange)
set-option -g window-status-current-format "#[fg=${thm_orange},bg=${thm_bg}]${left_sep}#[fg=${thm_bg},bg=${thm_orange},bold]#I #[fg=${thm_bg},bg=${thm_orange},bold]${window_icon} #{b:pane_current_path}#{?window_zoomed_flag, 󰁌 ,}#[fg=${thm_orange},bg=${thm_bg}]${right_sep}"

# ── 8. PLUGINS (TPM) ──
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'

run '~/.tmux/plugins/tpm/tpm'
